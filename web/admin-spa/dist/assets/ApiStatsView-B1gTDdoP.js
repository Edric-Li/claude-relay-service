import{aP as ut,r as C,c as F,aX as H,x as d,y as n,z as t,O as v,K as mt,aq as ft,u as e,aa as xt,f as gt,P as o,L as T,C as D,Q as B,ac as Y,B as et,R as W,q as yt,aW as pt,V as vt,o as bt,I as dt,J as ct,av as _t}from"./vue-vendor-Bsazo-x0.js";import{_ as G,a as kt}from"./index-CQMQBfR8.js";import{L as ht}from"./LogoTitle-C4hZ6Ojo.js";import{T as wt}from"./ThemeToggle-6E_OkE8z.js";import{b as $t}from"./vendor-Dr8jvgFu.js";import{_ as St}from"./WindowCountdown-BTXjZ8Dc.js";import"./element-plus-CqiD73Lu.js";class Ct{constructor(){this.baseURL=window.location.origin,this.isDev=!1}async request(x,a={}){try{this.isDev&&x.startsWith("/admin")&&(x="/webapi"+x);const p=await fetch(`${this.baseURL}${x}`,{headers:{"Content-Type":"application/json",...a.headers},...a}),b=await p.json();if(!p.ok)throw new Error(b.message||`请求失败: ${p.status}`);return b}catch(p){throw console.error("API Stats request error:",p),p}}async getKeyId(x){return this.request("/apiStats/api/get-key-id",{method:"POST",body:JSON.stringify({apiKey:x})})}async getUserStats(x){return this.request("/apiStats/api/user-stats",{method:"POST",body:JSON.stringify({apiId:x})})}async getUserModelStats(x,a="daily"){return this.request("/apiStats/api/user-model-stats",{method:"POST",body:JSON.stringify({apiId:x,period:a})})}async getOemSettings(){try{return await this.request("/admin/oem-settings")}catch(x){return console.error("Failed to load OEM settings:",x),{success:!0,data:{siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}}}async getBatchStats(x){return this.request("/apiStats/api/batch-stats",{method:"POST",body:JSON.stringify({apiIds:x})})}async getBatchModelStats(x,a="daily"){return this.request("/apiStats/api/batch-model-stats",{method:"POST",body:JSON.stringify({apiIds:x,period:a})})}}const j=new Ct,Q=ut("apistats",()=>{const R=C(""),x=C(null),a=C(!1),p=C(!1),b=C(!0),g=C(""),f=C("daily"),u=C(null),_=C([]),q=C(null),L=C(null),O=C({siteName:"",siteIcon:"",siteIconData:""}),U=C(!1),A=C([]),P=C([]),m=C(null),r=C([]),M=C([]),V=F(()=>{const l={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return U.value&&m.value?f.value==="daily"?m.value.dailyUsage||l:m.value.monthlyUsage||l:f.value==="daily"?q.value||l:L.value||l}),J=F(()=>{if(!u.value||!V.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const l=V.value,y=u.value.limits;return{tokenUsage:y.tokenLimit>0?Math.min(l.allTokens/y.tokenLimit*100,100):0,costUsage:y.dailyCostLimit>0?Math.min(l.cost/y.dailyCostLimit*100,100):0,requestUsage:y.rateLimitRequests>0?Math.min(l.requests/y.rateLimitRequests*100,100):0}});async function I(){if(U.value)return st();const l=R.value.trim();if(!l){g.value="请输入 API Key";return}if(l.length<10||l.length>512){g.value="API Key 格式无效：长度应在 10-512 个字符之间";return}a.value=!0,g.value="",u.value=null,_.value=[],x.value=null;try{const y=await j.getKeyId(l);if(y.success){x.value=y.data.id;const h=await j.getUserStats(x.value);if(h.success)u.value=h.data,await w(),g.value="",ot();else throw new Error(h.message||"查询失败")}else throw new Error(y.message||"获取 API Key ID 失败")}catch(y){console.error("Query stats error:",y),g.value=y.message||"查询统计数据失败，请检查您的 API Key 是否正确",u.value=null,_.value=[],x.value=null}finally{a.value=!1}}async function w(){x.value&&(await Promise.all([E("daily"),E("monthly")]),await z(f.value))}async function E(l){try{const y=await j.getUserModelStats(x.value,l);if(y.success){const h=y.data||[],K={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};h.forEach($=>{var N;K.requests+=$.requests||0,K.inputTokens+=$.inputTokens||0,K.outputTokens+=$.outputTokens||0,K.cacheCreateTokens+=$.cacheCreateTokens||0,K.cacheReadTokens+=$.cacheReadTokens||0,K.allTokens+=$.allTokens||0,K.cost+=((N=$.costs)==null?void 0:N.total)||0}),K.formattedCost=rt(K.cost),l==="daily"?q.value=K:L.value=K}else console.warn(`Failed to load ${l} stats:`,y.message)}catch(y){console.error(`Load ${l} stats error:`,y)}}async function z(l="daily"){if(x.value){p.value=!0;try{const y=await j.getUserModelStats(x.value,l);if(y.success)_.value=y.data||[];else throw new Error(y.message||"加载模型统计失败")}catch(y){console.error("Load model stats error:",y),_.value=[]}finally{p.value=!1}}}async function at(l){if(!(f.value===l||p.value)){if(f.value=l,U.value&&P.value.length>0){await Z(l);return}(l==="daily"&&!q.value||l==="monthly"&&!L.value)&&await E(l),await z(l)}}async function X(){var l,y;if(x.value){a.value=!0,g.value="",u.value=null,_.value=[];try{const h=await j.getUserStats(x.value);if(h.success)u.value=h.data,console.log("API Stats - Full response:",h.data),console.log("API Stats - limits data:",h.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(l=h.data.limits)==null?void 0:l.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(y=h.data.limits)==null?void 0:y.weeklyOpusCost),await w(),g.value="";else throw new Error(h.message||"查询失败")}catch(h){console.error("Load stats with apiId error:",h),g.value=h.message||"查询统计数据失败",u.value=null,_.value=[]}finally{a.value=!1}}}async function it(){b.value=!0;try{const l=await j.getOemSettings();l&&l.success&&l.data&&(O.value={...O.value,...l.data})}catch(l){console.error("Error loading OEM settings:",l),O.value={siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}finally{b.value=!1}}function rt(l){return typeof l!="number"||l===0?"$0.000000":l>=1?"$"+l.toFixed(2):l>=.01?"$"+l.toFixed(4):"$"+l.toFixed(6)}function ot(){if(x.value){const l=new URL(window.location);l.searchParams.set("apiId",x.value),window.history.pushState({},"",l)}}async function st(){const l=i();if(l.length===0){g.value="请输入至少一个有效的 API Key";return}a.value=!0,g.value="",m.value=null,r.value=[],M.value=[],_.value=[],A.value=l,P.value=[];try{const y=await Promise.allSettled(l.map(N=>j.getKeyId(N))),h=[],K=[];if(y.forEach((N,tt)=>{N.status==="fulfilled"&&N.value.success?(h.push(N.value.data.id),K.push(l[tt])):M.value.push(l[tt])}),h.length===0)throw new Error("所有 API Key 都无效");P.value=h,A.value=K;const $=await j.getBatchStats(h);if($.success)m.value=$.data.aggregated,r.value=$.data.individual,u.value=$.data.aggregated,q.value=$.data.aggregated.dailyUsage||null,L.value=$.data.aggregated.monthlyUsage||null,await Z(f.value),s();else throw new Error($.message||"批量查询失败")}catch(y){console.error("Batch query error:",y),g.value=y.message||"批量查询统计数据失败",m.value=null,r.value=[]}finally{a.value=!1}}async function Z(l="daily"){if(P.value.length!==0){p.value=!0;try{const y=await j.getBatchModelStats(P.value,l);if(y.success)_.value=y.data||[];else throw new Error(y.message||"加载批量模型统计失败")}catch(y){console.error("Load batch model stats error:",y),_.value=[]}finally{p.value=!1}}}function i(){if(!R.value)return[];const l=R.value.split(/[,\n]+/).map(h=>h.trim()).filter(h=>h.length>=10&&h.length<=512);return[...new Set(l)].slice(0,30)}function s(){if(P.value.length>0){const l=new URL(window.location);l.searchParams.set("apiIds",P.value.join(",")),l.searchParams.set("batch","true"),window.history.pushState({},"",l)}}function c(){R.value=""}function k(){u.value=null,_.value=[],q.value=null,L.value=null,g.value="",f.value="daily",x.value=null,A.value=[],P.value=[],m.value=null,r.value=[],M.value=[]}function S(){R.value="",U.value=!1,k()}return{apiKey:R,apiId:x,loading:a,modelStatsLoading:p,oemLoading:b,error:g,statsPeriod:f,statsData:u,modelStats:_,dailyStats:q,monthlyStats:L,oemSettings:O,multiKeyMode:U,apiKeys:A,apiIds:P,aggregatedStats:m,individualStats:r,invalidKeys:M,currentPeriodData:V,usagePercentages:J,queryStats:I,queryBatchStats:st,loadAllPeriodStats:w,loadPeriodStats:E,loadModelStats:z,loadBatchModelStats:Z,switchPeriod:at,loadStatsWithApiId:X,loadOemSettings:it,clearData:k,clearInput:c,reset:S}}),Tt={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},Lt={class:"mx-auto max-w-4xl"},Kt={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},At={class:"lg:col-span-3"},Pt=["disabled"],Mt={class:"lg:col-span-1"},It=["disabled"],Dt={key:0,class:"fas fa-spinner loading-spinner"},qt={key:1,class:"fas fa-search"},Rt={__name:"ApiKeyInput",setup(R){const x=Q(),{apiKey:a,loading:p}=H(x),{queryStats:b}=x,g=F(()=>a.value&&a.value.trim().length>0);return(f,u)=>(n(),d("div",Tt,[u[5]||(u[5]=t("div",{class:"wide-card-title mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-chart-line mr-3"}),v(" 使用统计查询 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),t("div",Lt,[u[3]||(u[3]=t("div",{class:"control-bar mb-4"},[t("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-key mr-2"}),v(" 输入您的 API Key ")])],-1)),t("div",Kt,[t("div",At,[mt(t("input",{"onUpdate:modelValue":u[0]||(u[0]=_=>gt(a)?a.value=_:null),class:"wide-card-input w-full",disabled:e(p),placeholder:"请输入您的 API Key (cr_...)",type:"password",onKeyup:u[1]||(u[1]=xt((..._)=>e(b)&&e(b)(..._),["enter"]))},null,40,Pt),[[ft,e(a)]])]),t("div",Mt,[t("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:e(p)||!g.value,onClick:u[2]||(u[2]=(..._)=>e(b)&&e(b)(..._))},[e(p)?(n(),d("i",Dt)):(n(),d("i",qt)),v(" "+o(e(p)?"查询中...":"查询统计"),1)],8,It)])]),u[4]||(u[4]=t("div",{class:"security-notice mt-4"},[t("i",{class:"fas fa-shield-alt mr-2"}),v(" 您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途 ")],-1))])]))}},Ut=G(Rt,[["__scopeId","data-v-845b6ad3"]]),Ot={class:"space-y-6 md:space-y-8"},Nt={class:"grid grid-cols-1 items-stretch gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},Et={class:"card-section"},jt={class:"section-header"},Ft={class:"header-title"},Wt={key:0,class:"info-grid"},Bt={class:"info-item"},Vt={class:"info-value"},zt={class:"info-item"},Jt={class:"info-value text-green-600 dark:text-emerald-400"},Yt={key:0,class:"info-item"},Ht={class:"info-value text-red-500 dark:text-red-400"},Gt={class:"info-item"},Qt={class:"info-value"},Xt={class:"info-item"},Zt={class:"info-value"},te={class:"info-item"},ee={class:"info-value text-indigo-600 dark:text-indigo-300"},se={key:1,class:"info-item xl:col-span-2"},ae={class:"space-y-2"},ie={class:"truncate"},re={class:"font-semibold"},oe={key:1,class:"info-grid"},le={class:"info-item"},ne={class:"info-value break-all"},de={class:"info-item"},ce={class:"info-item"},ue={class:"info-value"},me={class:"info-item"},fe={class:"info-value break-all"},xe={class:"info-item xl:col-span-2"},ge={class:"info-value"},ye={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},pe={key:0,class:"text-red-500 dark:text-red-400"},ve={key:1,class:"text-orange-500 dark:text-orange-400"},be={key:2},_e={key:2,class:"text-gray-400 dark:text-gray-500"},ke={class:"card-section"},he={class:"section-header"},we={class:"header-tag"},$e={class:"metric-grid"},Se={class:"metric-card"},Ce={class:"metric-value text-green-600 dark:text-emerald-300"},Te={class:"metric-label"},Le={class:"metric-card"},Ke={class:"metric-value text-blue-600 dark:text-sky-300"},Ae={class:"metric-label"},Pe={class:"metric-card"},Me={class:"metric-value text-purple-600 dark:text-violet-300"},Ie={class:"metric-label"},De={class:"metric-card"},qe={class:"metric-value text-amber-500 dark:text-amber-300"},Re={class:"metric-label"},Ue={key:0,class:"card-section"},Oe={class:"flex items-center justify-between gap-3"},Ne={class:"flex items-center gap-3"},Ee={class:"account-name"},je={class:"account-sub"},Fe={key:0,class:"mt-3 space-y-2"},We={class:"progress-row"},Be={class:"progress-track"},Ve={class:"progress-value"},ze={class:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},Je={key:0,class:"font-medium text-indigo-600 dark:text-indigo-400"},Ye={key:1,class:"mt-3"},He={key:0,class:"space-y-2"},Ge={class:"quota-header"},Qe={class:"quota-percent"},Xe={class:"progress-track"},Ze={class:"quota-foot"},ts={key:1,class:"rounded-xl bg-slate-100 px-3 py-2 text-xs text-slate-500 dark:bg-slate-800 dark:text-slate-300"},es={__name:"StatsOverview",setup(R){const x=Q(),{statsData:a,statsPeriod:p,currentPeriodData:b,multiKeyMode:g,aggregatedStats:f,individualStats:u,invalidKeys:_}=H(x),q=F(()=>!u.value||u.value.length===0?[]:[...u.value].sort((i,s)=>{var c,k;return(((c=s.usage)==null?void 0:c.allTokens)||0)-(((k=i.usage)==null?void 0:k.allTokens)||0)}).slice(0,3)),L=i=>{var c;return!f.value||!f.value.usage.allTokens?0:((((c=i.usage)==null?void 0:c.allTokens)||0)/f.value.usage.allTokens*100).toFixed(1)},O=i=>{if(!i)return"无";try{return $t(i).format("YYYY年MM月DD日 HH:mm")}catch{return"格式错误"}},U=i=>i?new Date(i).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",A=i=>i?new Date(i)<new Date:!1,P=i=>{if(!i)return!1;const k=(new Date(i)-new Date)/(1e3*60*60*24);return k>0&&k<=7},m=i=>(typeof i!="number"&&(i=parseInt(i)||0),i===0?"0":i>=1e6?(i/1e6).toFixed(1)+"M":i>=1e3?(i/1e3).toFixed(1)+"K":i.toLocaleString()),r=i=>({claude:"Claude",gemini:"Gemini",all:"全部模型"})[i]||i||"未知",M=F(()=>{var c,k;const i=(k=(c=a.value)==null?void 0:c.accounts)==null?void 0:k.details;if(!i)return[];const s=[];return i.claude&&i.claude.accountType==="dedicated"&&s.push({key:"claude",...i.claude}),i.openai&&i.openai.accountType==="dedicated"&&s.push({key:"openai",...i.openai}),s}),V=F(()=>{const i=M.value.length;return i<=1?"md:grid-cols-1 lg:grid-cols-1":i===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),J=i=>i?i.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",I=i=>{if(!i||i<=0)return"";const s=Math.floor(i),c=Math.floor(s/1440),k=Math.floor(s%1440/60),S=s%60;return c>0?k>0?`${c}天${k}小时`:`${c}天`:k>0?S>0?`${k}小时${S}分钟`:`${k}小时`:`${S}分钟`},w=i=>{if(!i)return{text:"状态未知",class:"text-gray-400"};if(i.isRateLimited){const s=I(i.minutesRemaining);return{text:`限流中${s?` · 剩余约 ${s}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},E=(i,s)=>{if(!i||!s)return"暂无时间窗口信息";const c=new Date(i),k=new Date(s),S=l=>`${`${l.getHours()}`.padStart(2,"0")}:${`${l.getMinutes()}`.padStart(2,"0")}`;return`${S(c)} - ${S(k)}`},z=i=>{if(!i||i<=0)return"";const s=Math.floor(i/60),c=i%60;return s>0?`${s}小时${c}分钟`:`${c}分钟`},at=(i,s)=>{var k;if(!i)return"bg-gradient-to-r from-blue-500 to-indigo-500";if((k=s==null?void 0:s.rateLimitStatus)!=null&&k.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const c=String(i).toLowerCase();return c==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":c==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-blue-500 to-indigo-500"},X=i=>{if(!i)return null;const s=typeof i.usedPercent=="number"&&!Number.isNaN(i.usedPercent)?i.usedPercent:null,c=typeof i.resetAfterSeconds=="number"&&!Number.isNaN(i.resetAfterSeconds)?i.resetAfterSeconds:null,k=typeof i.remainingSeconds=="number"?i.remainingSeconds:null,S=i.resetAt?Date.parse(i.resetAt):null;return c!==null&&(k!==null&&k<=0||S!==null&&!Number.isNaN(S)&&Date.now()>=S)?0:s===null?null:Math.max(0,Math.min(100,s))},it=i=>{const s=X(i);return s===null?"bg-gradient-to-r from-gray-300 to-gray-400":s>=90?"bg-gradient-to-r from-red-500 to-red-600":s>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},rt=i=>{const s=X(i);return s===null?"0%":`${s}%`},ot=i=>{const s=X(i);return s===null?"--":`${s.toFixed(1)}%`},st=i=>{if(!i)return"--";let s=i.remainingSeconds;if(s==null&&(s=i.resetAfterSeconds),s==null||Number.isNaN(Number(s)))return"--";s=Math.max(0,Math.floor(Number(s)));const c=Math.floor(s/86400),k=Math.floor(s%86400/3600),S=Math.floor(s%3600/60),l=s%60;return c>0?k>0?`${c}天${k}小时`:`${c}天`:k>0?S>0?`${k}小时${S}分钟`:`${k}小时`:S>0?`${S}分钟`:`${l}秒`},Z=i=>i==="secondary"?"周限":"5h";return(i,s)=>(n(),d("div",Ot,[t("div",Nt,[t("div",Et,[t("header",jt,[t("i",{class:D(["header-icon",e(g)?"fas fa-layer-group text-purple-500":"fas fa-info-circle text-blue-500"])},null,2),t("h3",Ft,o(e(g)?"批量查询概要":"API Key 信息"),1)]),e(g)&&e(f)?(n(),d("div",Wt,[t("div",Bt,[s[0]||(s[0]=t("p",{class:"info-label"},"查询 Keys 数",-1)),t("p",Vt,o(e(f).totalKeys)+" 个",1)]),t("div",zt,[s[2]||(s[2]=t("p",{class:"info-label"},"有效 Keys 数",-1)),t("p",Jt,[s[1]||(s[1]=t("i",{class:"fas fa-check-circle mr-1"},null,-1)),v(o(e(f).activeKeys)+" 个 ",1)])]),e(_).length>0?(n(),d("div",Yt,[s[4]||(s[4]=t("p",{class:"info-label"},"无效 Keys 数",-1)),t("p",Ht,[s[3]||(s[3]=t("i",{class:"fas fa-times-circle mr-1"},null,-1)),v(o(e(_).length)+" 个 ",1)])])):T("",!0),t("div",Gt,[s[5]||(s[5]=t("p",{class:"info-label"},"总请求数",-1)),t("p",Qt,o(m(e(f).usage.requests)),1)]),t("div",Xt,[s[6]||(s[6]=t("p",{class:"info-label"},"总 Token 数",-1)),t("p",Zt,o(m(e(f).usage.allTokens)),1)]),t("div",te,[s[7]||(s[7]=t("p",{class:"info-label"},"总费用",-1)),t("p",ee,o(e(f).usage.formattedCost),1)]),e(u).length>1?(n(),d("div",se,[s[8]||(s[8]=t("p",{class:"info-label"},"Top 3 贡献占比",-1)),t("div",ae,[(n(!0),d(B,null,Y(q.value,c=>(n(),d("div",{key:c.apiId,class:"contributor-item"},[t("span",ie,o(c.name),1),t("span",re,o(L(c))+"%",1)]))),128))])])):T("",!0)])):(n(),d("div",oe,[t("div",le,[s[9]||(s[9]=t("p",{class:"info-label"},"名称",-1)),t("p",ne,o(e(a).name),1)]),t("div",de,[s[10]||(s[10]=t("p",{class:"info-label"},"状态",-1)),t("p",{class:D(["info-value font-semibold",e(a).isActive?"text-green-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},[t("i",{class:D(["mr-1",e(a).isActive?"fas fa-check-circle":"fas fa-times-circle"])},null,2),v(" "+o(e(a).isActive?"活跃":"已停用"),1)],2)]),t("div",ce,[s[11]||(s[11]=t("p",{class:"info-label"},"权限",-1)),t("p",ue,o(r(e(a).permissions)),1)]),t("div",me,[s[12]||(s[12]=t("p",{class:"info-label"},"创建时间",-1)),t("p",fe,o(O(e(a).createdAt)),1)]),t("div",xe,[s[17]||(s[17]=t("p",{class:"info-label"},"过期时间",-1)),t("div",ge,[e(a).expirationMode==="activation"&&!e(a).isActivated?(n(),d(B,{key:0},[s[13]||(s[13]=t("span",{class:"text-amber-600 dark:text-amber-400"},[t("i",{class:"fas fa-pause-circle mr-1"}),v("未激活 ")],-1)),t("span",ye," 首次使用后 "+o(e(a).activationDays||(e(a).activationUnit==="hours"?24:30))+" "+o(e(a).activationUnit==="hours"?"小时":"天")+"过期 ",1)],64)):e(a).expiresAt?(n(),d(B,{key:1},[A(e(a).expiresAt)?(n(),d("span",pe,s[14]||(s[14]=[t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),v("已过期 ",-1)]))):P(e(a).expiresAt)?(n(),d("span",ve,[s[15]||(s[15]=t("i",{class:"fas fa-clock mr-1"},null,-1)),v(o(U(e(a).expiresAt)),1)])):(n(),d("span",be,o(U(e(a).expiresAt)),1))],64)):(n(),d("span",_e,s[16]||(s[16]=[t("i",{class:"fas fa-infinity mr-1"},null,-1),v("永不过期 ",-1)])))])])]))]),t("div",ke,[t("header",he,[s[18]||(s[18]=t("i",{class:"header-icon fas fa-chart-bar text-green-500"},null,-1)),s[19]||(s[19]=t("h3",{class:"header-title"},"使用统计概览",-1)),t("span",we,o(e(p)==="daily"?"今日":"本月"),1)]),t("div",$e,[t("div",Se,[t("p",Ce,o(m(e(b).requests)),1),t("p",Te,o(e(p)==="daily"?"今日":"本月")+"请求数",1)]),t("div",Le,[t("p",Ke,o(m(e(b).allTokens)),1),t("p",Ae,o(e(p)==="daily"?"今日":"本月")+"Token 数",1)]),t("div",Pe,[t("p",Me,o(e(b).formattedCost||"$0.000000"),1),t("p",Ie,o(e(p)==="daily"?"今日":"本月")+"费用",1)]),t("div",De,[t("p",qe,o(m(e(b).inputTokens)),1),t("p",Re,o(e(p)==="daily"?"今日":"本月")+"输入 Token",1)])])])]),!e(g)&&M.value.length>0?(n(),d("div",Ue,[s[21]||(s[21]=t("header",{class:"section-header"},[t("i",{class:"header-icon fas fa-plug text-indigo-500"}),t("h3",{class:"header-title"},"专属账号运行状态"),t("span",{class:"header-tag"},"实时更新")],-1)),t("div",{class:D(["grid grid-cols-1 gap-4",V.value])},[(n(!0),d(B,null,Y(M.value,c=>{var k,S,l,y,h,K;return n(),d("div",{key:c.id||c.key,class:"account-card"},[t("div",Oe,[t("div",Ne,[t("span",{class:D(["account-icon",c.platform==="claude"?"icon-claude":"icon-openai"])},[t("i",{class:D(c.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),t("div",null,[t("p",Ee,o(J(c)),1),t("p",je,o(c.platform==="claude"?"会话窗口":"额度窗口"),1)])]),w(c.rateLimitStatus)?(n(),d("div",{key:0,class:D(["rate-badge",w(c.rateLimitStatus).class])},[s[20]||(s[20]=t("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),v(" "+o(w(c.rateLimitStatus).text),1)],2)):T("",!0)]),c.platform==="claude"?(n(),d("div",Fe,[t("div",We,[t("div",Be,[t("div",{class:D(["progress-bar",at((k=c.sessionWindow)==null?void 0:k.sessionWindowStatus,c)]),style:et({width:`${Math.min(100,Math.max(0,((S=c.sessionWindow)==null?void 0:S.progress)||0))}%`})},null,6)]),t("span",Ve,o(Math.min(100,Math.max(0,Math.round(((l=c.sessionWindow)==null?void 0:l.progress)||0))))+"% ",1)]),t("div",ze,[t("span",null,o(E((y=c.sessionWindow)==null?void 0:y.windowStart,(h=c.sessionWindow)==null?void 0:h.windowEnd)),1),((K=c.sessionWindow)==null?void 0:K.remainingTime)>0?(n(),d("span",Je," 剩余 "+o(z(c.sessionWindow.remainingTime)),1)):T("",!0)])])):c.platform==="openai"?(n(),d("div",Ye,[c.codexUsage?(n(),d("div",He,[(n(),d(B,null,Y(["primary","secondary"],$=>{var N,tt,lt,nt;return t("div",{key:`${c.key}-${$}`,class:"quota-row"},[t("div",Ge,[t("span",{class:D(["quota-tag",$==="primary"?"tag-indigo":"tag-blue"])},o(Z($)),3),t("span",Qe,o(ot((N=c.codexUsage)==null?void 0:N[$])),1)]),t("div",Xe,[t("div",{class:D(["progress-bar",it((tt=c.codexUsage)==null?void 0:tt[$])]),style:et({width:rt((lt=c.codexUsage)==null?void 0:lt[$])})},null,6)]),t("div",Ze," 重置剩余 "+o(st((nt=c.codexUsage)==null?void 0:nt[$])),1)])}),64))])):(n(),d("p",ts," 暂无额度使用数据 "))])):T("",!0)])}),128))],2)])):T("",!0)]))}},ss=G(es,[["__scopeId","data-v-b72df2cd"]]),as={class:"card p-4 md:p-6"},is={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},rs={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},os={class:"space-y-2 md:space-y-3"},ls={class:"flex items-center justify-between"},ns={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},ds={class:"flex items-center justify-between"},cs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},us={class:"flex items-center justify-between"},ms={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},fs={class:"flex items-center justify-between"},xs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},gs={class:"mt-3 border-t border-gray-200 pt-3 dark:border-gray-700 md:mt-4 md:pt-4"},ys={class:"flex items-center justify-between font-bold text-gray-900 dark:text-gray-100"},ps={class:"text-sm md:text-base"},vs={class:"text-lg md:text-xl"},bs={__name:"TokenDistribution",setup(R){const x=Q(),{statsPeriod:a,currentPeriodData:p}=H(x),b=g=>(typeof g!="number"&&(g=parseInt(g)||0),g===0?"0":g>=1e6?(g/1e6).toFixed(1)+"M":g>=1e3?(g/1e3).toFixed(1)+"K":g.toLocaleString());return(g,f)=>(n(),d("div",as,[t("h3",is,[f[0]||(f[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-coins mr-2 text-sm text-yellow-500 md:mr-3 md:text-base"}),v(" Token 使用分布 ")],-1)),t("span",rs,"("+o(e(a)==="daily"?"今日":"本月")+")",1)]),t("div",os,[t("div",ls,[f[1]||(f[1]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-right mr-1 text-xs text-green-500 md:mr-2 md:text-sm"}),v(" 输入 Token ")],-1)),t("span",ns,o(b(e(p).inputTokens)),1)]),t("div",ds,[f[2]||(f[2]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-left mr-1 text-xs text-blue-500 md:mr-2 md:text-sm"}),v(" 输出 Token ")],-1)),t("span",cs,o(b(e(p).outputTokens)),1)]),t("div",us,[f[3]||(f[3]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-save mr-1 text-xs text-purple-500 md:mr-2 md:text-sm"}),v(" 缓存创建 Token ")],-1)),t("span",ms,o(b(e(p).cacheCreateTokens)),1)]),t("div",fs,[f[4]||(f[4]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-download mr-1 text-xs text-orange-500 md:mr-2 md:text-sm"}),v(" 缓存读取 Token ")],-1)),t("span",xs,o(b(e(p).cacheReadTokens)),1)])]),t("div",gs,[t("div",ys,[t("span",ps,o(e(a)==="daily"?"今日":"本月")+"总计",1),t("span",vs,o(b(e(p).allTokens)),1)])])]))}},_s=G(bs,[["__scopeId","data-v-d9e5c1dd"]]),ks={class:"flex h-full flex-col gap-4 md:gap-6"},hs={class:"card flex h-full flex-col p-4 md:p-6"},ws={class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},$s={key:0,class:"space-y-4"},Ss={class:"rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Cs={class:"mb-3 flex items-center justify-between"},Ts={class:"rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 dark:bg-blue-800 dark:text-blue-200"},Ls={class:"grid grid-cols-2 gap-3"},Ks={class:"text-center"},As={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},Ps={class:"text-center"},Ms={class:"text-lg font-bold text-green-600"},Is={class:"rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Ds={class:"space-y-2"},qs={class:"flex items-center justify-between"},Rs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Us={class:"flex items-center justify-between"},Os={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Ns={class:"flex items-center justify-between"},Es={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},js={key:0,class:"rounded-lg bg-red-50 p-3 text-sm dark:bg-red-900/20"},Fs={class:"text-red-700 dark:text-red-300"},Ws={key:1,class:"space-y-4 md:space-y-5"},Bs={class:"mb-2 flex items-center justify-between"},Vs={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},zs={key:0},Js={key:1,class:"flex items-center gap-1"},Ys={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Hs={key:1,class:"h-2 w-full rounded-full bg-gray-200"},Gs={class:"mb-2 flex items-center justify-between"},Qs={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},Xs={key:0},Zs={key:1,class:"flex items-center gap-1"},ta={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ea={key:1,class:"h-2 w-full rounded-full bg-gray-200"},sa={key:0},aa={class:"mb-2 flex items-center justify-between"},ia={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},ra={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},oa={key:1},la={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},na={key:0},da={key:1},ca={key:2},ua={class:"space-y-4 border-t border-gray-100 pt-3 dark:border-gray-700"},ma={class:"flex items-center justify-between"},fa={class:"text-sm font-medium text-gray-900 md:text-base"},xa={key:0},ga={key:1,class:"flex items-center gap-1"},ya={class:"flex items-center justify-between"},pa={class:"text-sm font-medium text-gray-900 md:text-base"},va={key:0,class:"text-orange-600"},ba={key:1,class:"text-green-600"},_a={class:"space-y-2"},ka={class:"flex items-center justify-between"},ha={class:"text-sm font-medium text-gray-900 md:text-base"},wa={key:0,class:"text-orange-600"},$a={key:1,class:"text-green-600"},Sa={key:0,class:"flex flex-wrap gap-2 rounded-lg bg-blue-50 p-2 dark:bg-blue-900/20 md:p-3"},Ca={key:0,class:"card p-4 md:p-6"},Ta={class:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20 md:p-4"},La={class:"space-y-1 md:space-y-2"},Ka={class:"break-all text-gray-800 dark:text-gray-200"},Aa={__name:"LimitConfig",setup(R){const x=Q(),{statsData:a,multiKeyMode:p,aggregatedStats:b,invalidKeys:g}=H(x),f=F(()=>{var r;const m=(r=a.value)==null?void 0:r.restrictions;return m?m.enableModelRestriction===!0&&Array.isArray(m.restrictedModels)&&m.restrictedModels.length>0:!1}),u=F(()=>{var r;const m=(r=a.value)==null?void 0:r.restrictions;return m?m.enableClientRestriction===!0&&Array.isArray(m.allowedClients)&&m.allowedClients.length>0:!1}),_=()=>{if(!a.value.limits.dailyCostLimit||a.value.limits.dailyCostLimit===0)return 0;const m=a.value.limits.currentDailyCost/a.value.limits.dailyCostLimit*100;return Math.min(m,100)},q=()=>{const m=_();return m>=100?"bg-red-500":m>=80?"bg-yellow-500":"bg-green-500"},L=()=>{if(!a.value.limits.totalCostLimit||a.value.limits.totalCostLimit===0)return 0;const m=a.value.limits.currentTotalCost/a.value.limits.totalCostLimit*100;return Math.min(m,100)},O=()=>{const m=L();return m>=100?"bg-red-500":m>=80?"bg-yellow-500":"bg-blue-500"},U=()=>{if(!a.value.limits.weeklyOpusCostLimit||a.value.limits.weeklyOpusCostLimit===0)return 0;const m=a.value.limits.weeklyOpusCost/a.value.limits.weeklyOpusCostLimit*100;return Math.min(m,100)},A=()=>{const m=U();return m>=100?"bg-red-500":m>=80?"bg-yellow-500":"bg-indigo-500"},P=m=>(typeof m!="number"&&(m=parseInt(m)||0),m===0?"0":m>=1e6?(m/1e6).toFixed(1)+"M":m>=1e3?(m/1e3).toFixed(1)+"K":m.toLocaleString());return(m,r)=>(n(),d("div",ks,[t("div",hs,[t("h3",ws,[r[0]||(r[0]=t("i",{class:"fas fa-shield-alt mr-2 text-sm text-red-500 md:mr-3 md:text-base"},null,-1)),v(" "+o(e(p)?"限制配置（聚合查询模式）":"限制配置"),1)]),e(p)&&e(b)?(n(),d("div",$s,[t("div",Ss,[t("div",Cs,[r[1]||(r[1]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-layer-group mr-2 text-blue-500"}),v(" API Keys 概况 ")],-1)),t("span",Ts,o(e(b).activeKeys)+"/"+o(e(b).totalKeys),1)]),t("div",Ls,[t("div",Ks,[t("div",As,o(e(b).totalKeys),1),r[2]||(r[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"总计 Keys",-1))]),t("div",Ps,[t("div",Ms,o(e(b).activeKeys),1),r[3]||(r[3]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"激活 Keys",-1))])])]),t("div",Is,[r[7]||(r[7]=t("div",{class:"mb-3 flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-purple-500"}),t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聚合统计摘要")],-1)),t("div",Ds,[t("div",qs,[r[4]||(r[4]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-database mr-1 text-gray-400"}),v(" 总请求数 ")],-1)),t("span",Rs,o(P(e(b).usage.requests)),1)]),t("div",Us,[r[5]||(r[5]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-coins mr-1 text-yellow-500"}),v(" 总 Tokens ")],-1)),t("span",Os,o(P(e(b).usage.allTokens)),1)]),t("div",Ns,[r[6]||(r[6]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-dollar-sign mr-1 text-green-500"}),v(" 总费用 ")],-1)),t("span",Es,o(e(b).usage.formattedCost),1)])])]),e(g)&&e(g).length>0?(n(),d("div",js,[r[8]||(r[8]=t("i",{class:"fas fa-exclamation-triangle mr-2 text-red-600 dark:text-red-400"},null,-1)),t("span",Fs,o(e(g).length)+" 个无效的 API Key ",1)])):T("",!0),r[9]||(r[9]=t("div",{class:"rounded-lg bg-gray-50 p-3 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400"},[t("i",{class:"fas fa-info-circle mr-1"}),v(" 每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置 ")],-1))])):T("",!0),e(p)?T("",!0):(n(),d("div",Ws,[t("div",null,[t("div",Bs,[r[11]||(r[11]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日费用限制",-1)),t("span",Vs,[e(a).limits.dailyCostLimit>0?(n(),d("span",zs," $"+o(e(a).limits.currentDailyCost.toFixed(4))+" / $"+o(e(a).limits.dailyCostLimit.toFixed(2)),1)):(n(),d("span",Js,[v(" $"+o(e(a).limits.currentDailyCost.toFixed(4))+" / ",1),r[10]||(r[10]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(a).limits.dailyCostLimit>0?(n(),d("div",Ys,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",q()]),style:et({width:_()+"%"})},null,6)])):(n(),d("div",Hs,r[12]||(r[12]=[t("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])))]),t("div",null,[t("div",Gs,[r[14]||(r[14]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"总费用限制",-1)),t("span",Qs,[e(a).limits.totalCostLimit>0?(n(),d("span",Xs," $"+o(e(a).limits.currentTotalCost.toFixed(4))+" / $"+o(e(a).limits.totalCostLimit.toFixed(2)),1)):(n(),d("span",Zs,[v(" $"+o(e(a).limits.currentTotalCost.toFixed(4))+" / ",1),r[13]||(r[13]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(a).limits.totalCostLimit>0?(n(),d("div",ta,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",O()]),style:et({width:L()+"%"})},null,6)])):(n(),d("div",ea,r[15]||(r[15]=[t("div",{class:"h-2 rounded-full bg-blue-500",style:{width:"0%"}},null,-1)])))]),e(a).limits.weeklyOpusCostLimit>0?(n(),d("div",sa,[t("div",aa,[r[16]||(r[16]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"Opus 模型周费用限制",-1)),t("span",ia," $"+o(e(a).limits.weeklyOpusCost.toFixed(4))+" / $"+o(e(a).limits.weeklyOpusCostLimit.toFixed(2)),1)]),t("div",ra,[t("div",{class:D(["h-2 rounded-full transition-all duration-300",A()]),style:et({width:U()+"%"})},null,6)])])):T("",!0),e(a).limits.rateLimitWindow>0&&(e(a).limits.rateLimitRequests>0||e(a).limits.tokenLimit>0||e(a).limits.rateLimitCost>0)?(n(),d("div",oa,[W(St,{"cost-limit":e(a).limits.rateLimitCost,"current-cost":e(a).limits.currentWindowCost,"current-requests":e(a).limits.currentWindowRequests,"current-tokens":e(a).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":e(a).limits.rateLimitWindow,"request-limit":e(a).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":e(a).limits.tokenLimit,"window-end-time":e(a).limits.windowEndTime,"window-remaining-seconds":e(a).limits.windowRemainingSeconds,"window-start-time":e(a).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),t("div",la,[r[17]||(r[17]=t("i",{class:"fas fa-info-circle mr-1"},null,-1)),e(a).limits.rateLimitCost>0?(n(),d("span",na,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):e(a).limits.tokenLimit>0?(n(),d("span",da,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(n(),d("span",ca," 仅限制请求次数 "))])])):T("",!0),t("div",ua,[t("div",ma,[r[19]||(r[19]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"并发限制",-1)),t("span",fa,[e(a).limits.concurrencyLimit>0?(n(),d("span",xa,o(e(a).limits.concurrencyLimit),1)):(n(),d("span",ga,r[18]||(r[18]=[t("i",{class:"fas fa-infinity text-gray-400"},null,-1)])))])]),t("div",ya,[r[22]||(r[22]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"模型限制",-1)),t("span",pa,[f.value?(n(),d("span",va,[r[20]||(r[20]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),v(" 限制 "+o(e(a).restrictions.restrictedModels.length)+" 个模型 ",1)])):(n(),d("span",ba,r[21]||(r[21]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),v(" 允许所有模型 ",-1)])))])]),t("div",_a,[t("div",ka,[r[25]||(r[25]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"客户端限制",-1)),t("span",ha,[u.value?(n(),d("span",wa,[r[23]||(r[23]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),v(" 限 "+o(e(a).restrictions.allowedClients.length)+" 种客户端使用 ",1)])):(n(),d("span",$a,r[24]||(r[24]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),v(" 允许所有客户端 ",-1)])))])]),u.value?(n(),d("div",Sa,[(n(!0),d(B,null,Y(e(a).restrictions.allowedClients,M=>(n(),d("span",{key:M,class:"flex items-center gap-1 rounded-full bg-white px-2 py-1 text-xs text-blue-700 shadow-sm dark:bg-slate-900 dark:text-blue-300 md:text-sm"},[r[26]||(r[26]=t("i",{class:"fas fa-id-badge"},null,-1)),v(" "+o(M),1)]))),128))])):T("",!0)])])]))]),f.value?(n(),d("div",Ca,[r[30]||(r[30]=t("h3",{class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},[t("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),v(" 详细限制信息 ")],-1)),t("div",Ta,[r[28]||(r[28]=t("h4",{class:"mb-2 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300 md:mb-3 md:text-base"},[t("i",{class:"fas fa-robot mr-1 text-xs md:mr-2 md:text-sm"}),v(" 受限模型列表 ")],-1)),t("div",La,[(n(!0),d(B,null,Y(e(a).restrictions.restrictedModels,M=>(n(),d("div",{key:M,class:"rounded border border-amber-200 bg-white px-2 py-1 text-xs dark:border-amber-700 dark:bg-gray-800 md:px-3 md:py-2 md:text-sm"},[r[27]||(r[27]=t("i",{class:"fas fa-ban mr-1 text-xs text-red-500 md:mr-2"},null,-1)),t("span",Ka,o(M),1)]))),128))]),r[29]||(r[29]=t("p",{class:"mt-2 text-xs text-amber-700 dark:text-amber-400 md:mt-3"},[t("i",{class:"fas fa-info-circle mr-1"}),v(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):T("",!0)]))}},Pa=G(Aa,[["__scopeId","data-v-4e85e423"]]),Ma={class:"card p-4 md:p-6"},Ia={class:"mb-4 md:mb-6"},Da={class:"flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:text-xl"},qa={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Ra={key:0,class:"py-6 text-center md:py-8"},Ua={key:1,class:"space-y-3 md:space-y-4"},Oa={class:"mb-2 flex items-start justify-between md:mb-3"},Na={class:"min-w-0 flex-1"},Ea={class:"break-all text-base font-bold text-gray-900 dark:text-gray-100 md:text-lg"},ja={class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},Fa={class:"ml-3 flex-shrink-0 text-right"},Wa={class:"text-base font-bold text-green-600 md:text-lg"},Ba={class:"grid grid-cols-2 gap-2 text-xs md:grid-cols-4 md:gap-3 md:text-sm"},Va={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},za={class:"font-medium text-gray-900 dark:text-gray-100"},Ja={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Ya={class:"font-medium text-gray-900 dark:text-gray-100"},Ha={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Ga={class:"font-medium text-gray-900 dark:text-gray-100"},Qa={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Xa={class:"font-medium text-gray-900 dark:text-gray-100"},Za={key:2,class:"py-6 text-center text-gray-500 dark:text-gray-400 md:py-8"},ti={class:"text-sm md:text-base"},ei={__name:"ModelUsageStats",setup(R){const x=Q(),{statsPeriod:a,modelStats:p,modelStatsLoading:b}=H(x),g=f=>(typeof f!="number"&&(f=parseInt(f)||0),f===0?"0":f>=1e6?(f/1e6).toFixed(1)+"M":f>=1e3?(f/1e3).toFixed(1)+"K":f.toLocaleString());return(f,u)=>(n(),d("div",Ma,[t("div",Ia,[t("h3",Da,[u[0]||(u[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-robot mr-2 text-sm text-indigo-500 md:mr-3 md:text-base"}),v(" 模型使用统计 ")],-1)),t("span",qa,"("+o(e(a)==="daily"?"今日":"本月")+")",1)])]),e(b)?(n(),d("div",Ra,u[1]||(u[1]=[t("i",{class:"fas fa-spinner loading-spinner mb-2 text-xl text-gray-600 dark:text-gray-400 md:text-2xl"},null,-1),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"加载模型统计数据中...",-1)]))):e(p).length>0?(n(),d("div",Ua,[(n(!0),d(B,null,Y(e(p),(_,q)=>{var L;return n(),d("div",{key:q,class:"model-usage-item"},[t("div",Oa,[t("div",Na,[t("h4",Ea,o(_.model),1),t("p",ja,o(_.requests)+" 次请求 ",1)]),t("div",Fa,[t("div",Wa,o(((L=_.formatted)==null?void 0:L.total)||"$0.000000"),1),u[2]||(u[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},"总费用",-1))])]),t("div",Ba,[t("div",Va,[u[3]||(u[3]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输入 Token",-1)),t("div",za,o(g(_.inputTokens)),1)]),t("div",Ja,[u[4]||(u[4]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输出 Token",-1)),t("div",Ya,o(g(_.outputTokens)),1)]),t("div",Ha,[u[5]||(u[5]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存创建",-1)),t("div",Ga,o(g(_.cacheCreateTokens)),1)]),t("div",Qa,[u[6]||(u[6]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存读取",-1)),t("div",Xa,o(g(_.cacheReadTokens)),1)])])])}),128))])):(n(),d("div",Za,[u[7]||(u[7]=t("i",{class:"fas fa-chart-pie mb-3 text-2xl md:text-3xl"},null,-1)),t("p",ti," 暂无"+o(e(a)==="daily"?"今日":"本月")+"模型使用数据 ",1)]))]))}},si=G(ei,[["__scopeId","data-v-b3b8dc5f"]]),ai={class:"glass-strong mb-6 rounded-3xl p-4 shadow-xl md:mb-8 md:p-6"},ii={class:"flex flex-col items-center justify-between gap-4 md:flex-row"},ri={class:"flex items-center gap-2 md:gap-4"},oi={class:"flex items-center"},li={key:0,class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},ni={class:"tab-content"},di={key:0,class:"mb-6 md:mb-8"},ci={class:"rounded-xl border border-red-500/30 bg-red-500/20 p-3 text-sm text-red-800 backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 md:p-4 md:text-base"},ui={key:1,class:"fade-in"},mi={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},fi={class:"mb-4 border-b border-gray-200 pb-4 dark:border-gray-700 md:mb-6 md:pb-6"},xi={class:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center md:gap-4"},gi={class:"flex w-full gap-2 md:w-auto"},yi=["disabled"],pi=["disabled"],vi={class:"mb-6 mt-6 grid grid-cols-1 gap-4 md:mb-8 md:mt-8 md:gap-6 xl:grid-cols-2 xl:items-stretch"},bi={__name:"ApiStatsView",setup(R){const x=pt(),a=Q(),p=kt(),b=F(()=>p.isDarkMode),{apiKey:g,apiId:f,loading:u,modelStatsLoading:_,oemLoading:q,error:L,statsPeriod:O,statsData:U,oemSettings:A}=H(a),{queryStats:P,switchPeriod:m,loadStatsWithApiId:r,loadOemSettings:M,reset:V}=a,J=I=>{(I.ctrlKey||I.metaKey)&&I.key==="Enter"&&(!u.value&&g.value.trim()&&P(),I.preventDefault()),I.key==="Escape"&&V()};return yt(()=>{p.initTheme(),M();const I=x.query.apiId,w=x.query.apiKey;I&&I.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i)?(f.value=I,r()):w&&w.length>10&&(g.value=w),document.addEventListener("keydown",J)}),vt(()=>{document.removeEventListener("keydown",J)}),bt(g,I=>{I||a.clearData()}),(I,w)=>{const E=_t("router-link");return n(),d("div",{class:D(["min-h-screen p-4 md:p-6",b.value?"gradient-bg-dark":"gradient-bg"])},[t("div",ai,[t("div",ii,[W(ht,{loading:e(q),"logo-src":e(A).siteIconData||e(A).siteIcon,subtitle:"API Key 使用统计",title:e(A).siteName},null,8,["loading","logo-src","title"]),t("div",ri,[t("div",oi,[W(wt,{mode:"dropdown"})]),e(A).ldapEnabled||e(A).showAdminButton!==!1?(n(),d("div",li)):T("",!0),e(A).ldapEnabled?(n(),dt(E,{key:1,class:"user-login-button flex items-center gap-2 rounded-2xl px-4 py-2 text-white transition-all duration-300 md:px-5 md:py-2.5",to:"/user-login"},{default:ct(()=>w[2]||(w[2]=[t("i",{class:"fas fa-user text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"用户登录",-1)])),_:1,__:[2]})):T("",!0),e(A).showAdminButton!==!1?(n(),dt(E,{key:2,class:"admin-button-refined flex items-center gap-2 rounded-2xl px-4 py-2 transition-all duration-300 md:px-5 md:py-2.5",to:"/dashboard"},{default:ct(()=>w[3]||(w[3]=[t("i",{class:"fas fa-shield-alt text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"管理后台",-1)])),_:1,__:[3]})):T("",!0)])])]),t("div",ni,[W(Ut),e(L)?(n(),d("div",di,[t("div",ci,[w[4]||(w[4]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),v(" "+o(e(L)),1)])])):T("",!0),e(U)?(n(),d("div",ui,[t("div",mi,[t("div",fi,[t("div",xi,[w[7]||(w[7]=t("div",{class:"flex items-center gap-2 md:gap-3"},[t("i",{class:"fas fa-clock text-base text-blue-500 md:text-lg"}),t("span",{class:"text-base font-medium text-gray-700 dark:text-gray-200 md:text-lg"},"统计时间范围")],-1)),t("div",gi,[t("button",{class:D(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(O)==="daily"}]]),disabled:e(u)||e(_),onClick:w[0]||(w[0]=z=>e(m)("daily"))},w[5]||(w[5]=[t("i",{class:"fas fa-calendar-day text-xs md:text-sm"},null,-1),v(" 今日 ",-1)]),10,yi),t("button",{class:D(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e(O)==="monthly"}]]),disabled:e(u)||e(_),onClick:w[1]||(w[1]=z=>e(m)("monthly"))},w[6]||(w[6]=[t("i",{class:"fas fa-calendar-alt text-xs md:text-sm"},null,-1),v(" 本月 ",-1)]),10,pi)])])]),W(ss),t("div",vi,[W(_s,{class:"h-full"}),W(Pa,{class:"h-full"})]),W(si)])])):T("",!0)])],2)}}},Ti=G(bi,[["__scopeId","data-v-ce04947d"]]);export{Ti as default};
